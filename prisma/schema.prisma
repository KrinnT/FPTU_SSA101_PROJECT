datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        String   @id @default(cuid())
  name      String?
  email     String   @unique
  phone     String?
  password  String   // Hashed
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  assessments Assessment[]
  moodLogs    MoodLog[]
  chats       Chat[]
  flashcardDecks FlashcardDeck[]
  fixedEvents FixedEvent[]
  tasks       Task[]
  posts       Post[]
  comments    Comment[]
}


model Assessment {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  depressionScore Int
  anxietyScore    Int
  stressScore     Int
  
  createdAt       DateTime @default(now())

  @@index([userId, createdAt])
}

model MoodLog {
  id       String   @id @default(cuid())
  userId   String
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  mood     Int      // 1-5
  energy   Int      // 0-100
  focus    Int      // 0-100
  emotion  String
  note     String?
  
  createdAt DateTime @default(now())

  @@index([userId, createdAt])
}

// --- Chat System ---
model Chat {
  id        String    @id @default(cuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  title     String
  createdAt DateTime  @default(now())
  messages  Message[]

  @@index([userId, createdAt])
}

model Message {
  id        String   @id @default(cuid())
  chatId    String
  chat      Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  role      String   // "user", "assistant", "system"
  content   String   @db.Text
  createdAt DateTime @default(now())

  @@index([chatId, createdAt])
}

// --- Flashcard System ---
model FlashcardDeck {
  id          String      @id @default(cuid())
  userId      String
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  title       String
  description String?
  color       String      // Stores Tailwind class like "bg-rose-500"
  createdAt   DateTime    @default(now())
  cards       Flashcard[]

  @@index([userId, createdAt])
}

model Flashcard {
  id        String        @id @default(cuid())
  deckId    String
  deck      FlashcardDeck @relation(fields: [deckId], references: [id], onDelete: Cascade)
  front     String
  back      String
  createdAt DateTime      @default(now())

  @@index([deckId])
}

// --- Scheduler System ---
model FixedEvent {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  day       String   // "Monday", etc.
  startTime String   // "08:00"
  endTime   String   // "10:00"
  name      String
  createdAt DateTime @default(now())

  @@index([userId])
}

model Task {
  id                String   @id @default(cuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name              String
  duration          Int      // in hours
  
  // Scheduling info (if assigned)
  scheduledDay      String?  // "Monday"
  scheduledStartTime String? // "09:00"
  
  createdAt         DateTime @default(now())

  @@index([userId])
}

// --- Community System ---
enum PostCategory {
  ACADEMIC      // Trao đổi học tập
  PSYCHOLOGY    // Tâm lý
  RESOURCES     // Tài liệu - đề thi
  OTHER
}

model Post {
  id        String       @id @default(cuid())
  authorId  String
  author    User         @relation(fields: [authorId], references: [id], onDelete: Cascade)
  content   String       @db.Text
  category  PostCategory @default(OTHER)
  likes     Int          @default(0)
  createdAt DateTime     @default(now())
  comments  Comment[]

  @@index([createdAt])
  @@index([authorId])
  @@index([category])
}

model Comment {
  id        String   @id @default(cuid())
  postId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  authorId  String
  author    User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  content   String   @db.Text
  createdAt DateTime @default(now())

  @@index([postId])
}

